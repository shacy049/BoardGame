@using WebMatrix.Data
@{
    var db = Database.Open("BoardGame");

    // Get existing families and themes
    var familyList = db.Query("SELECT Family FROM GameFamily ORDER BY Family");
    var themeList = db.Query("SELECT ThemeID, ThemeName FROM Theme ORDER BY ThemeName");

    string message = "";
    bool isSuccess = false;

    if (IsPost)
    {
        // Read values from the form
        var name = Request["Name"];
        var description = Request["Description"];
        var year = Request["YearPublished"];   // from <input type="date">
        var minPlayers = Request["MinPlayers"];
        var maxPlayers = Request["MaxPlayers"];
        var family = Request["Family"];
        var imagePath = Request["ImagePath"];
        var selectedThemeId = Request["ThemeID"];
        var newThemeName = Request["NewThemeName"];

        if (String.IsNullOrWhiteSpace(name) || String.IsNullOrWhiteSpace(description))
        {
            message = "Name and Description are required.";
        }
        else
        {
            // Get a new unique BGGId
            var newIdObj = db.QueryValue("SELECT ISNULL(MAX(BGGId), 0) + 1 FROM BoardGame");
            int newBGGId = Convert.ToInt32(newIdObj);

            // Insert the game
            db.Execute(@"
        INSERT INTO BoardGame
        (BGGId, Name, Description, YearPublished, MinPlayers, MaxPlayers, Family, ImagePath)
        VALUES
        (@0,   @1,   @2,          @3,           @4,         @5,         @6,     @7)",
                newBGGId,
                name,
                description,
                year,
                minPlayers,
                maxPlayers,
                family,
                imagePath
            );

<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Create Game</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
          rel="stylesheet" />
</head>
<body>
    <div class="container py-4">
        <a href="/Home/Index" class="btn btn-outline-secondary mb-3">&laquo; Back</a>

        <h2 class="mb-3 text-primary fw-bold text-center">Add New Board Game</h2>

        @if (!String.IsNullOrEmpty(message))
        {
            <div class="alert @(isSuccess ? "alert-success" : "alert-danger")">
                @message
            </div>
        }

        <div class="card shadow-sm p-4">
            <form method="post" action="/Home/Create">
                <div class="mb-3">
                    <label class="form-label" for="Name">Game Name</label>
                    <input type="text" name="Name" id="Name" class="form-control" required />
                </div>

                <div class="mb-3">
                    <label class="form-label" for="Description">Description</label>
                    <textarea name="Description" id="Description" class="form-control"
                              rows="3" required></textarea>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label" for="YearPublished">Year Published</label>
                        <input type="date" name="YearPublished" id="YearPublished"
                               class="form-control" />
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label" for="MinPlayers">Min Players</label>
                        <input type="number" name="MinPlayers" id="MinPlayers"
                               class="form-control" min="1" />
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label" for="MaxPlayers">Max Players</label>
                        <input type="number" name="MaxPlayers" id="MaxPlayers"
                               class="form-control" min="1" />
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="ImagePath">Image Path</label>
                    <input type="text" name="ImagePath" id="ImagePath"
                           class="form-control" placeholder="/Images/game.jpg or URL" />
                </div>
                <div class="mb-3">
                    <label class="form-label" for="Family">Game Family</label>
                    <select name="Family" id="Family" class="form-select">
                        <option value="">-- Select a family --</option>
                        @foreach (var fam in familyList)
                        {
                            <option value="@fam.Family">@fam.Family</option>
                        }
                    </select>
                </div>
                
  